<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CommandLineService.html">CommandLineService</a><ul class='methods'><li data-type='method'><a href="CommandLineService.html#.execute">execute</a></li><li data-type='method'><a href="CommandLineService.html#.init">init</a></li></ul></li><li><a href="Config.html">Config</a><ul class='methods'><li data-type='method'><a href="Config.html#.init">init</a></li></ul></li><li><a href="ExpressService.html">ExpressService</a><ul class='methods'><li data-type='method'><a href="ExpressService.html#.authorized">authorized</a></li><li data-type='method'><a href="ExpressService.html#.init">init</a></li><li data-type='method'><a href="ExpressService.html#.list_methods">list_methods</a></li></ul></li><li><a href="HooksManager.html">HooksManager</a><ul class='methods'><li data-type='method'><a href="HooksManager.html#.get_commands">get_commands</a></li><li data-type='method'><a href="HooksManager.html#.get_hooks">get_hooks</a></li><li data-type='method'><a href="HooksManager.html#.get_hooks_dir">get_hooks_dir</a></li><li data-type='method'><a href="HooksManager.html#.load">load</a></li><li data-type='method'><a href="HooksManager.html#.reload">reload</a></li><li data-type='method'><a href="HooksManager.html#.work_hook">work_hook</a></li></ul></li><li><a href="LocalService.html">LocalService</a><ul class='methods'><li data-type='method'><a href="LocalService.html#.connect_hook">connect_hook</a></li><li data-type='method'><a href="LocalService.html#.init">init</a></li><li data-type='method'><a href="LocalService.html#.manage_response">manage_response</a></li></ul></li><li><a href="log_file_path.html">log_file_path</a></li><li><a href="MainService.html">MainService</a><ul class='methods'><li data-type='method'><a href="MainService.html#.help">help</a></li><li data-type='method'><a href="MainService.html#.main">main</a></li><li data-type='method'><a href="MainService.html#.parse_commands">parse_commands</a></li><li data-type='method'><a href="MainService.html#.start_server">start_server</a></li><li data-type='method'><a href="MainService.html#.stop_server">stop_server</a></li></ul></li><li><a href="MonitorService.html">MonitorService</a><ul class='methods'><li data-type='method'><a href="MonitorService.html#.init">init</a></li><li data-type='method'><a href="MonitorService.html#.restart">restart</a></li><li data-type='method'><a href="MonitorService.html#.start">start</a></li><li data-type='method'><a href="MonitorService.html#.stop">stop</a></li></ul></li><li><a href="RpcService.html">RpcService</a><ul class='methods'><li data-type='method'><a href="RpcService.html#.init">init</a></li><li data-type='method'><a href="RpcService.html#.send">send</a></li></ul></li><li><a href="TelegramService.html">TelegramService</a><ul class='methods'><li data-type='method'><a href="TelegramService.html#.get_hook_id">get_hook_id</a></li><li data-type='method'><a href="TelegramService.html#.init">init</a></li><li data-type='method'><a href="TelegramService.html#.is_hooked">is_hooked</a></li><li data-type='method'><a href="TelegramService.html#.manage_message">manage_message</a></li><li data-type='method'><a href="TelegramService.html#.register_message_hook">register_message_hook</a></li><li data-type='method'><a href="TelegramService.html#.respond">respond</a></li><li data-type='method'><a href="TelegramService.html#.send">send</a></li><li data-type='method'><a href="TelegramService.html#.set_hook_id">set_hook_id</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="hooks_examples.html">hooks/examples</a></li><li><a href="hooks_sys.html">hooks/sys</a></li><li><a href="Logger.html">Logger</a><ul class='methods'><li data-type='method'><a href="Logger.html#.error">error</a></li><li data-type='method'><a href="Logger.html#.log">log</a></li><li data-type='method'><a href="Logger.html#.notify">notify</a></li><li data-type='method'><a href="Logger.html#.setLogFile">setLogFile</a></li><li data-type='method'><a href="Logger.html#.trace">trace</a></li></ul></li></ul>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><!-- language: lang-none -->
<pre class="prettyprint source"><code>╔╦╗┌─┐┬  ┌─┐┌─┐┬─┐┌─┐┌┬┐┌┬┐┌─┐┬─┐
 ║ ├┤ │  ├┤ │ ┬├┬┘├─┤││││││├┤ ├┬┘
 ╩ └─┘┴─┘└─┘└─┘┴└─┴ ┴┴ ┴┴ ┴└─┘┴└─</code></pre><p>Manage your device or server using <a href="https://telegram.org/"><strong>Telegram Messenger</strong></a>. Two way communication!</p>
<hr>
<h1>Synopsis</h1><p>Telegrammer is a little resident server born to allow easy device/server management via private Telegram chat.</p>
<p>It allows two-way communication using a registered Telegram Bot.</p>
<p>Actually Telegrammer allows device/server monitoring, device/server shell scripts and node functions execution, GPIO signaling (in/out), command line and web triggers to send message to the Bot chat.</p>
<p><em><strong>Making IT simple?</strong> Chat with your <strong>server</strong> or <strong>device</strong>. It will chat to you too :)</em></p>
<h1>Installation</h1><h2>Cloning/Forking this repository</h2><p>Step <strong>one</strong> is cloning or forking this repository in a directory on your computer, server or device. You can get using <em>npm</em> too.</p>
<p>Then <em>npm install</em> as usual.</p>
<p>You can install globally too (or <em>npm link</em> it). In this case You'll have a nice &quot;telegrammer&quot; executable in your bin folder to launch this software.</p>
<h2>Chatting with a BotFather</h2><p>Next step is creating a Bot on Telegram and obtain an authorization token. You'll have to chat with a special Bot called <strong>BotFather</strong> to register your Bot.</p>
<p>Just follow <a href="https://core.telegram.org/bots">this guide</a> to authorize your Bot.</p>
<p><strong>Keep in mind that actually only one instance of Telegrammer can be linked to a Bot (Telegram limitation), so if you need to monitor <em>two</em> devices you'll have to register <em>two</em> Bots. Then you can create a &quot;group chat&quot; with all your Bots to manage all the devices at once.</strong></p>
<h2>So you obtained your token, isn't it?</h2><p>You chatted with the BotFather and it made you an offer you can't refuse. Well...that went straight. Now open example config file you'll find in config folder, put your token here and save the file as shared.json.</p>
<p>You can override some values using <strong>NODE_ENV</strong>.json files in the same directory (<em>development.json, production.json, etc...</em>)</p>
<p>You can limit Telegrammer to respond only to certain usernames for extra security, or let it respond to anyone removing this property.</p>
<p>Put your Chat ID too. You can obtain it chatting with your bot and reading console output. If you don't specify it Telegrammer will try autoset it on first received message.</p>
<p><strong>Keep in mind that monitoring, command-line and web hook will not work until Chat ID is set.</strong></p>
<p>You can disable some services to lower memory consumpion (on devices like Raspberry Pi, for example) or for extra security.</p>
<blockquote>
<p>You can use this file to config your Hooks too.</p>
</blockquote>
<h1>Hooks? Sounds painful.</h1><p>So what the heck are those Hooks?</p>
<p>You can call them <strong>plugins</strong> if your heart's content. You can find some in the <strong>hooks/</strong> directory. Those are the files you'll use to define your commands (in/out) and monitoring services. Telegrammer will load all the <strong>.js</strong> and <strong>.json</strong> files in <strong>hooks/</strong> subfolder and, after checking it's actually an hook definition, will &quot;hook&quot; it.</p>
<p><em>You can define different kinds of hooks, and the same hook can &quot;activate&quot; many of them at once (for example monitoring a disk, sending you a message if disk space is low, and reacting to your command clearing it).</em></p>
<blockquote>
<p>The syntax is simple but powerful, I promise you that.</p>
</blockquote>
<h2>Input Hook (local command)</h2><p><strong>Those hooks are waiting for you to text them!</strong> They will react to a command or regex and act accordingly, running a node function, a GPIO sequence (<em>if you are on a device like a Raspberry Pi</em>), a shell command or script. Then Telegrammer will send you back a result or error.</p>
<p>You need to define some properties:</p>
<ul>
<li>either <strong>command</strong> or <strong>match</strong>. Your bot will react to the string defined in <strong>command</strong> preceded by <strong>/</strong> (so if you write 'blow_candles' it will react to '/blow_candles'), or to the regex pattern you'll define in match.</li>
<li>either <strong>action</strong> (that can be a string containing a shell command or a node function returning a <em>Promise</em>), <strong>shell</strong> (with the name of an executable in the same directory), a <strong>signal</strong> (that can be an array defining a GPIO pattern, an array of array of GPIO signals for multi PIN parallel signaling or a function returning a <em>Promise</em>) or a function named <strong>parse_response</strong> for &quot;confirmation enabled&quot; hooks.</li>
<li>a <strong>response</strong> and <strong>error</strong> strings. You can use some variables too (@error@ and @response@) to include action output/error.</li>
</ul>
<blockquote>
<p>Most of the defined functions require you to return a Promise. Telegrammer will send you back to the chat anything you will output &quot;resolving&quot; or &quot;rejecting&quot; your Promise, unless you define <strong>response: false</strong> in your hook or resolve with <strong>null</strong>. Just remember to resolve or reject your Promises, or the <strong>BotFather</strong> will be very unhappy and you'll risk finding a sewed horse head in your bed.</p>
</blockquote>
<p>All the hooks can define <strong>name</strong> and <strong>namespace</strong> properties, or those will be inferred using path and file name. You should define a <strong>description</strong> too, and an <strong>help</strong> that will be shown on home page or command line manual.</p>
<h2>Web Hook (http triggered command)</h2><p><strong>Those hooks are waiting for you to &quot;trigger&quot; them POSTing or GETting webpages!</strong> They will react to a specific express route, activate and send you a chat message.</p>
<p>You can use those hooks to create a &quot;central dispatcher&quot; server for a little network and trigger hooks from remote machines.</p>
<blockquote>
<p>You can have a little of extra security configuring <strong>auth_token_name</strong> and <strong>auth_token</strong> in your config file. Then you'll need to add this extra header to every request to trigger the Hooks.</p>
</blockquote>
<p>You need to define some properties:</p>
<ul>
<li>a <strong>route</strong> function that will execute your code and that responds to a route path and executes some code. I must returns a Promise. It will receive an object <strong>params</strong> with the params you defined in your hooks, the Telegrammer api (you can use it to send any message you want) and request &amp; response objects. Your page will answer with your &quot;resolve&quot; param, unless you return null.</li>
<li>Optionally the <strong>route_path</strong> or it will be generated using namespace/name of the hook.</li>
<li>Optionally a <strong>params</strong> key defining expected GET or POST params following <a href="https://github.com/75lb/command-line-args.git">Command Line Args</a> syntax.</li>
</ul>
<h2>Command Line Hook (bash callable commands)</h2><p><strong>Those hooks are waiting for you to &quot;trigger&quot; them calling them by name!</strong> They will react to a specific command line inputs, using '<em>git-like</em>' syntax and named parametes.</p>
<p>You can use those hooks to react to system events, cron jobs or daemon/application calling.</p>
<p>You can use <strong>./tel.sh</strong> script or the <strong>index.js</strong> file to execute them.</p>
<blockquote>
<p>You can ask for help on defined commands and params using the command line interface you can read in the next chapter.</p>
</blockquote>
<p>You need to define some properties:</p>
<ul>
<li>an <strong>exec</strong> function that will execute your code and will executes some code and returns a Promise. Will receive an object <strong>params</strong> with the params you defined in your hooks and the Telegrammer api (you can use it to send any message you want). Telegrammer will send in chat any value you will &quot;resolve&quot;.</li>
<li>Optionally the <strong>cmd_name</strong> or it will be generated using namespace/name of the hook.</li>
<li>Optionally a <strong>params</strong> key defining expected params following <a href="https://github.com/75lb/command-line-args.git">Command Line Args</a> syntax.</li>
</ul>
<h2>Monitor Hook (monitoring commands)</h2><p><strong>Those hooks will &quot;trigger&quot; themself whenever they want!</strong> They will react check at specified intervals something or react to GPIO inputs.</p>
<p>You can use those hooks to monitor cpu usage, disk space, file/directories changing or GPIO input if you are on a &quot;Raspberry Pi&quot; like device.</p>
<blockquote>
<p>Monitoring hooks can be CPU/memory consuming. Consider using large intervals.</p>
</blockquote>
<p>You need to define some properties:</p>
<ul>
<li>an <strong>interval</strong> expressed in milliseconds. Your check will be called every <em>interval</em> milliseconds.</li>
<li>a <strong>check</strong> function that will return a Promise. As always any param you'll pass to your &quot;resolve&quot; will be texted by the Bot. Your function will receive <strong>hook</strong> and Telegrammer <strong>api</strong> arguments, or a <strong>start_monitor</strong> and <strong>stop_monitor</strong> functions if you are feeling risky.</li>
<li>or a <strong>gpio</strong> object with pin id and an handler to monitor GPIO events. Your handler will receive <strong>err</strong>or code, pin read <strong>value</strong>, <strong>hook</strong> reference and Telegrammer <strong>api</strong>. Any param you'll pass to your &quot;resolve&quot; will be texted by the Bot.</li>
</ul>
<blockquote>
<p>You can find some examples in the hooks/examples directory. Feel free to trash it when you feel more confident on Hook definition.</p>
</blockquote>
<h1>Run (for your life)</h1><p>You can run the server using three (or four) alternatives:</p>
<pre class="prettyprint source"><code>npm start</code></pre><pre class="prettyprint source"><code>node index.js start</code></pre><p>or you can use the little shell script tel.sh</p>
<pre class="prettyprint source"><code>./tel.sh start</code></pre><p>If you installed it globally (-g) or <em>npm link</em>-ed it you can access to it from your console using the executable in your bin folder as this:</p>
<pre class="prettyprint source"><code>telegrammer start</code></pre><p>Feel free to <strong>daemonize</strong> Telegrammer. You can later stop the server just executing:</p>
<pre class="prettyprint source"><code>./tel.sh stop</code></pre><p>or</p>
<pre class="prettyprint source"><code>node index.js stop</code></pre><p>or</p>
<pre class="prettyprint source"><code>telegrammer stop</code></pre><h1>Configure</h1><p>Telegrammer can be configured in a <em>plètora</em> of ways. You can pass arguments when you start it, set environment variables, use a config file in your home folder or use the specific <em>environment-cascading</em> folder.</p>
<p>Specifically &quot;base&quot; arguments (usable on every command) are:</p>
<table>
<thead>
<tr>
<th>Command</th>
<th style="text-align:center">Short</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>--verbose</td>
<td style="text-align:center">-V</td>
<td><em>Set verbosity on or off</em></td>
</tr>
<tr>
<td>--telegramid</td>
<td style="text-align:center">-T</td>
<td><em>Set Telegram chat ID</em></td>
</tr>
<tr>
<td>--token</td>
<td style="text-align:center">-K</td>
<td><em>Set Bot token</em></td>
</tr>
<tr>
<td>--config-file</td>
<td style="text-align:center"></td>
<td><em>Set config file path (ignore config dir option)</em></td>
</tr>
<tr>
<td>--config-dir</td>
<td style="text-align:center"></td>
<td><em>Set config dir (useful when you install Telegram as global npm module)</em></td>
</tr>
<tr>
<td>--hooks-dir</td>
<td style="text-align:center"></td>
<td><em>Set hooks dir (useful when you install Telegram as global npm module)</em></td>
</tr>
<tr>
<td>--log-file</td>
<td style="text-align:center"></td>
<td><em>Set log file path</em></td>
</tr>
</tbody>
</table>
<p>You can set some of those using environment variables too:</p>
<table>
<thead>
<tr>
<th>Env Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>TEL_CONFIG_DIR</td>
<td><em>Set config dir</em></td>
</tr>
<tr>
<td>TEL_HOOKS_DIR</td>
<td><em>Set hooks dir</em></td>
</tr>
<tr>
<td>TEL_CID</td>
<td><em>Set Telegram chat ID</em></td>
</tr>
<tr>
<td>TEL_TOKEN</td>
<td><em>Set Bot token</em></td>
</tr>
</tbody>
</table>
<p>When Telegrammer starts will try to load a .js (or .json) file named &quot;.telegrammer.js&quot; (or &quot;.telegrammer.json&quot;) in your home folder (for <em>unix talkers</em> something like ~/.telegrammer.json). You can use this file to store your token or &quot;base config&quot;.</p>
<blockquote>
<p>Keep in mind that if you launch Telegrammer using a <em>root</em> bash script (like, for example, <em>/etc/rc.local</em>) you need to put this file in <em>root</em>'s home folder.</p>
</blockquote>
<p>Then Telegrammer will read &quot;shared.js&quot; (or &quot;shared.json&quot;) in your config folder (overriding &quot;home file&quot; values) and, as last step, environment specific files in the same folder (production.js, production.json, development.js, etc...)</p>
<blockquote>
<p>You can set hooks directory in config files too, using absolute path names or relative (to Telegrammer folder) ones.</p>
</blockquote>
<h1>Help!</h1><p>If Express is on you can navigate to your Telegrammer home page (<strong>localhost:express_port</strong>) to explore all hooks definitions. Standard port is 3000, but you can write in config or use PORT environment variable to control it.</p>
<p>You can have a little help using command line interface:</p>
<pre class="prettyprint source"><code>./tel.sh help</code></pre><p>or</p>
<pre class="prettyprint source"><code>node index.js help</code></pre><p>or</p>
<pre class="prettyprint source"><code>telegrammer help</code></pre><p>and following instructions.</p>
<p><strong>Your help output will include installed command line hooks, so it may change.</strong></p>
<blockquote>
<p>You can also read JsDocs generated documentation in the docs directory.</p>
</blockquote>
<h1>Issues</h1><p>As noted before you'll have to register a different Telegram Bot for every Telegrammer instance running as a server. It can be <strong>boooring</strong> (expecially as Bot names will fill up), but <em>no way out from this hell at the moment</em>.</p>
<p>Consider disabling <strong>express manager</strong> and <strong>web hooks</strong> on <em>memory-frugal</em> devices. Those are the most &quot;memory consuming&quot; managers.</p>
<h1>Team</h1><ul>
<li>Stefano &quot;Giano&quot; Valicchia - <a href="https://it.linkedin.com/in/stefanovalicchia">LinkedIn</a> - <a href="https://github.com/giano">Github</a> - <a href="https://twitter.com/tulo69">Twitter</a> - <a href="https://www.npmjs.com/~giano">Npm</a></li>
</ul>
<h1>License</h1><p>MIT License</p>
<p>Copyright (c) 2016 Stefano Valicchia</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the &quot;Software&quot;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
<h1>Contributing</h1><p>Feel free to fork, improve, modify and patch this code.</p></article>
    </section>






</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.0-dev</a> on Thu Apr 14 2016 15:58:08 GMT+0200 (CEST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>